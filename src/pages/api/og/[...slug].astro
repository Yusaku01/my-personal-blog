---
import { getCollection } from 'astro:content';

// getStaticPathsを追加（静的サイト生成に必要）
export async function getStaticPaths() {
  const posts = await getCollection('blog');

  // インデックスページ用のパスを追加
  const paths = [
    { params: { slug: 'index' } },
    { params: { slug: 'blog' } },
    { params: { slug: 'profile' } },
    { params: { slug: 'contact' } },
  ];

  // 各ブログ記事のパスを追加
  posts.forEach((post) => {
    paths.push({ params: { slug: post.slug } });
  });

  return paths;
}

// ルートパラメータを取得
const { slug } = Astro.params;

// 記事データを取得
let title = 'Yusaku Blog';
let description = '';
// 基本ページかブログ記事かを判定
let isBasicPage = false;

// 基本ページのスラッグリスト
const basicPageSlugs = ['index', 'blog', 'profile', 'contact'];
if (basicPageSlugs.includes(slug)) {
  isBasicPage = true;
}

if (slug === 'index') {
  title = 'SAKUSPACE';
} else if (slug === 'blog') {
  title = 'BLOG';
} else if (slug === 'profile') {
  title = 'PROFILE';
} else if (slug === 'contact') {
  title = 'CONTACT';
} else if (slug && slug !== 'index') {
  // 個別のブログ記事の場合
  try {
    const posts = await getCollection('blog');
    const post = posts.find((p) => p.slug === slug);
    if (post) {
      title = post.data.title;
      description = post.data.description || '';
    }
  } catch (error) {
    console.error('Error fetching blog post:', error);
  }
}

// レスポンスタイプを設定
Astro.response.headers.set('Content-Type', 'text/html');
---

<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>OGP Generator</title>
  </head>
  <body class="m-0 p-0 w-1200px h-630px flex font-sans">
    <div class="relative w-1200px h-630px overflow-hidden">
      {
        isBasicPage ? (
          <div class="w-full h-full flex flex-col justify-center items-center p-60px box-border text-gray-900 bg-white">
            <h1 class="text-58px mb-20px leading-1.4 max-w-80% text-center font-bold text-gray-900">
              {title}
            </h1>
          </div>
        ) : (
          <div class="w-full h-full flex flex-col justify-center items-center p-60px box-border bg-white">
            <div class="w-full flex flex-col items-center">
              <h1 class="text-48px mb-20px leading-1.3 max-w-80% text-center font-bold text-gray-900">
                {title}
              </h1>
            </div>
            <div class="absolute bottom-40px right-40px text-30px font-bold text-gray-900">
              SAKUSPACE
            </div>
          </div>
        )
      }
    </div>
  </body>
</html>

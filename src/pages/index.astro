---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import HeroSection from '../components/HeroSection.astro';
import { PostCard } from '../components/Blog/PostCard';
import SectionHeading from '../components/SectionHeading.astro';
import { getQiitaPosts } from '../lib/api-clients/qiita';

const posts = await getCollection('blog');
const qiitaPosts = await getQiitaPosts('ngtnysk');

const allPosts = [
  ...posts.map((post) => ({
    title: post.data.title,
    url: `/blog/${post.slug}`,
    publishDate: post.data.publishDate,
    excerpt: post.data.description,
    thumbnail: post.data.image,
    isExternal: false,
  })),
  ...qiitaPosts,
].sort((a, b) => b.publishDate.getTime() - a.publishDate.getTime());

const POSTS_PER_SECTION = 4;
---

<Layout title="SAKUSPACE">
  <HeroSection title="SAKUSPACE" />
  <div class="content-section py-16">
    <div class="max-w-7xl mx-auto px-4">
      <section class="mb-16">
        <SectionHeading title="最新の記事" />
        <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4">
          {
            allPosts
              .slice(0, POSTS_PER_SECTION)
              .map((post) => (
                <PostCard
                  client:load
                  title={post.title}
                  url={post.url}
                  publishDate={post.publishDate}
                  excerpt={post.excerpt}
                  platform={post.platform}
                  isExternal={post.isExternal}
                  thumbnail={post.thumbnail}
                />
              ))
          }
        </div>

        <div class="text-center mt-8">
          <a
            href="/blog"
            class="inline-block bg-gray-900 text-white px-6 py-2 rounded-md hover:bg-gray-800 transition-colors"
          >
            すべての記事を見る
          </a>
        </div>
      </section>
    </div>
  </div>
</Layout>

<style>
  .hero-section {
    background-color: #fff;
    background-size: cover;
    background-position: center;
  }

  .site-title {
    font-family: 'Noto Sans JP', sans-serif;
    letter-spacing: 0.2em;
  }
</style>
